# 2025-09-11

## 本周进展

- ✅ 华南虎的开源项目已成功跑通，视频测试效果整体不错，但存在一定的不稳定性。如图所示
    ![这是我期望的状态](images/1.png)
    ![这是会出现的不稳定的状态](images/2.png)
- ✅ 学习了 PnP（Perspective-n-Point）算法，对其原理和应用有了初步了解。
- ✅ 刚刚入门卡尔曼滤波，目前对其原理还不是很清晰。

## 下周计划

- 🔍 深入研究华南虎项目的算法实现，思考是否可以用神经网络进行优化。
- 🔗 学习并理解他们的链码算法，尝试分析其优缺点及应用场景。
https://blog.csdn.net/qq_63029071/article/details/140361695
--





---

# 2025-09-19

## 进展概览

- 学习了 C++20 的 concept 语法，用于约束模板参数类型。
- 掌握了 OpenCV 与 C++ 多线程处理方法。
- 理解了 lambda 表达式的用法及其捕获方式。
- 了解了 inline 内联函数的作用。
- 学习了 pytorch 的数据预处理
---

## 重点知识整理

### 1. C++20 concept 示例
```cpp
// 声明一个模板参数 T
template <typename T>
concept ContourWrapperConvertable = requires(T t) {
    requires ContourWrapperPtrType<T>;
    // 要求 T 满足 ContourWrapperPtrType 这个 concept
};
```

### 2. OpenCV 多线程二值化处理
```cpp
void RuneDetector::binary(const cv::Mat &src, cv::Mat &bin, PixChannel target_color, uint8_t threshold) {
    if(src.type() != CV_8UC3) {
        VC_THROW_ERROR("The image type of 'src' is incorrect");
    }
    if(target_color != PixChannel::RED && target_color != PixChannel::BLUE) {
        VC_THROW_ERROR("The value of 'target_color' is incorrect");
    }
    auto ch1 = target_color == PixChannel::RED ? PixChannel::RED : PixChannel::BLUE;
    auto ch2 = target_color == PixChannel::RED ? PixChannel::BLUE : PixChannel::RED;
    bin = Mat::zeros(Size(src.cols, src.rows), CV_8UC1);
    parallel_for_(Range(0, src.rows), [&](const Range &range) {
        const uchar *data_src = nullptr;
        uchar *data_bin = nullptr;
        for (int row = range.start; row < range.end; ++row) {
            data_src = src.ptr<uchar>(row);
            data_bin = bin.ptr<uchar>(row);
            for (int col = 0; col < src.cols; ++col)
                if (data_src[3 * col + ch1] - data_src[3 * col + ch2] > threshold)
                    data_bin[col] = 255;
        }
    });
}
```
> 说明：将二值化后的矩阵以行为单位划分并并行处理，提高效率。

### 3. lambda 表达式
```cpp
[捕获列表](参数列表) -> 返回类型 {
    // 函数体
}
```
本质是匿名函数。默认捕获内容为 const，若需修改副本可加 `mutable` 关键词。

**示例：副本捕获**
```cpp
int count = 0;
auto counter = [count]() mutable {
    count++;
    std::cout << count << std::endl;
};
counter(); // 输出 1
counter(); // 输出 2
// 外部 count 仍为 0
```

**示例：引用捕获**
```cpp
auto lambda2 = [&b]() {
    b++;
    std::cout << "内部 b (引用): " << b << std::endl;
};
lambda2();
std::cout << "外部 b: " << b << std::endl;
// 外部 b 已被修改
```

### 4. inline 内联函数
> 直接将函数调用替换为函数体，提高效率。


---

# 2025-10-04

## 进展

- 靶车静止和小陀螺状态下可以稳定击打，但车子大幅度移动时无法稳定识别。
- 华南虎能量机关的通信正在写
- 写一下考核使用的代码

## 问题
- 现在自瞄的问题是，预测的逻辑类似物体运动的惯性，但是当靶车急停反向移动的时候镜头丢失目标，在控制器延迟时间后就会自动归到原位。
- 和电控沟通尽早上车测试同济自瞄，我个人正好也在看一下同济的打符，如果可以正好可以搭配使用。




---

# 2025-10-11

## 进度
- 开始调试同济打符程序，因为自瞄的后续可能也是同济的，为了保持接口统一可以先调试同济打符。
- 把这个考核的代码写了，最后选择了一个非常简单的版本，只考察了一下指针和函数的。

## 下周
- 最好的情况是下周的云台已经可以追踪这个能量机关了。
- 后面可能会有一个正大杯的水赛。



---

# 2025-10-17

## 进度
- 这周车子和能量机关都在修，进度卡住了，只能看看代码
- 准备下周二的期中考试，以及面试。

## 
- 最近想再看一看这个神经网络的内容
- 打打正大杯，准备一下美赛。



---

# 2025-10-29

## 近况
- 去面试了一个实验室，这几天准备美赛和正大杯，下下周马上还有常微分的结课考试，事情有点多
- 最近找时间把修好的能量机关的数据集一录制打一打标签，希望原本的模型可以直接使用，但是难说，这个能量机关的R标太靠前了，不知道会不会对模型的训练有影响
- 最近学习一下wsl2和docker的使用方式，找一找不吃经济的AI使用方式



---

# 2025-11-04

## 进度
- 刚弄完美赛的一个模拟
- 能量机关灯效没什么大问题了，找cyp测试一下通信后可以先看看识别效果。
- 同济demo_test的预测文件有点问题，我测试完通信和识别改一下参数，应该就是参数问题



# 2025-11-15

## 进度
- 第一次测试从cboard_test的运行，理论上来说是可以收到数据的，但是由于测试时使用的是随即生成的数据，而不是符合要求的IMU（陀螺仪）格式的数据，校验数据不符合规格后忽视。
```
void CBoard::callback(const can_frame & frame)
{
  auto timestamp = std::chrono::steady_clock::now();

  if (frame.can_id == quaternion_canid_) {
    auto x = (int16_t)(frame.data[0] << 8 | frame.data[1]) / 1e4;
    auto y = (int16_t)(frame.data[2] << 8 | frame.data[3]) / 1e4;
    auto z = (int16_t)(frame.data[4] << 8 | frame.data[5]) / 1e4;
    auto w = (int16_t)(frame.data[6] << 8 | frame.data[7]) / 1e4;

    if (std::abs(x * x + y * y + z * z + w * w - 1) > 1e-2) {
      tools::logger()->warn("Invalid q: {} {} {} {}", w, x, y, z);
      return;
    }

    queue_.push({{w, x, y, z}, timestamp});
  }
  ```
四元数有效性校验（在 cboard.cpp 的 callback 中）：
行为：从 CAN 帧解析 x,y,z,w；计算 x^2+y^2+z^2+w^2；若与 1 的差绝对值 > 1e-2，则记录 warning 并 return（不 push 到队列）。
意义：防止范数非 1 的四元数进入插值队列，避免无效姿态污染插值。

## 问题
- 同济有些函数体没有写完，数据格式的转换也有问题
- 相机不见了我靠

# 2025-11-15

## 进度
已经可以拿无人机的云台测试了，但是由于R标缺失的问题，pnp解算完的数据返回到auto_buff_debug_mpc后cv绘制的绿色框总会在目标中抖动。

已经排除了识别的问题，之所以抖动是因为能量机关当时处于静止状态运动模型无法判断符叶运动方向，所以会左右抖动预判转动方向，当方向确认之后预测的方向就会固定。

## 问题
原本的pnp解算很需要这个R标解算中心，但是现在R标有点问题。（现在可以发光了，上面放了一张纸来均光）
火控的问题还没测试，还有就是预测的延迟值还没有确定。
接下来可以测试一下华南的buff，没有用模型纯传统视觉，还不知道效果怎么样。

- 过几天要买相机了