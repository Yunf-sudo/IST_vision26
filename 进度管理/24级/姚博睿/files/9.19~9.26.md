

# 9.19~9.26

## 进展概览

- 学习了 C++20 的 concept 语法，用于约束模板参数类型。
- 掌握了 OpenCV 与 C++ 多线程处理方法。
- 理解了 lambda 表达式的用法及其捕获方式。
- 了解了 inline 内联函数的作用。
- 学习了 pytorch 的数据预处理
---

## 重点知识整理

### 1. C++20 concept 示例
```cpp
// 声明一个模板参数 T
template <typename T>
concept ContourWrapperConvertable = requires(T t) {
    requires ContourWrapperPtrType<T>;
    // 要求 T 满足 ContourWrapperPtrType 这个 concept
};
```

### 2. OpenCV 多线程二值化处理
```cpp
void RuneDetector::binary(const cv::Mat &src, cv::Mat &bin, PixChannel target_color, uint8_t threshold) {
    if(src.type() != CV_8UC3) {
        VC_THROW_ERROR("The image type of 'src' is incorrect");
    }
    if(target_color != PixChannel::RED && target_color != PixChannel::BLUE) {
        VC_THROW_ERROR("The value of 'target_color' is incorrect");
    }
    auto ch1 = target_color == PixChannel::RED ? PixChannel::RED : PixChannel::BLUE;
    auto ch2 = target_color == PixChannel::RED ? PixChannel::BLUE : PixChannel::RED;
    bin = Mat::zeros(Size(src.cols, src.rows), CV_8UC1);
    parallel_for_(Range(0, src.rows), [&](const Range &range) {
        const uchar *data_src = nullptr;
        uchar *data_bin = nullptr;
        for (int row = range.start; row < range.end; ++row) {
            data_src = src.ptr<uchar>(row);
            data_bin = bin.ptr<uchar>(row);
            for (int col = 0; col < src.cols; ++col)
                if (data_src[3 * col + ch1] - data_src[3 * col + ch2] > threshold)
                    data_bin[col] = 255;
        }
    });
}
```
> 说明：将二值化后的矩阵以行为单位划分并并行处理，提高效率。

### 3. lambda 表达式
```cpp
[捕获列表](参数列表) -> 返回类型 {
    // 函数体
}
```
本质是匿名函数。默认捕获内容为 const，若需修改副本可加 `mutable` 关键词。

**示例：副本捕获**
```cpp
int count = 0;
auto counter = [count]() mutable {
    count++;
    std::cout << count << std::endl;
};
counter(); // 输出 1
counter(); // 输出 2
// 外部 count 仍为 0
```

**示例：引用捕获**
```cpp
auto lambda2 = [&b]() {
    b++;
    std::cout << "内部 b (引用): " << b << std::endl;
};
lambda2();
std::cout << "外部 b: " << b << std::endl;
// 外部 b 已被修改
```

### 4. inline 内联函数
> 直接将函数调用替换为函数体，提高效率。

---

## 推荐学习链接

- [CSDN 表示与描述——链码讲解](https://blog.csdn.net/qq_63029071/article/details/140361695)
- [跟李牧学AI的pytorch部分](https://zh-v2.d2l.ai/chapter_preliminaries/ndarray.html)

---

## 下周
- 学习到线性神经网络
- 梳理华南的解算部分的算法，查漏补缺
